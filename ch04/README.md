# [服务器上的 git](https://www.progit.cn/#_%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84_git)

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [服务器上的 git](#服务器上的-githttpswwwprogitcn_e69c8de58aa1e599a8e4b88ae79a84_git)
  - [4.1 协议](#41-协议)
    - [4.1.1 本地协议](#411-本地协议)
    - [4.1.2 HTTP 协议](#412-http-协议)
    - [4.1.3 SSH 协议](#413-ssh-协议)
    - [4.1.4 Git 协议](#414-git-协议)
  - [4.2 在服务器上搭建 git](#42-在服务器上搭建-git)
  - [4.3 生成 ssh 公钥](#43-生成-ssh-公钥)
  - [4.4 配置服务器](#44-配置服务器)
  - [4.5 Git 守护进程](#45-git-守护进程)
  - [4.6 Smart HTTP](#46-smart-http)
  - [4.7 GitWeb](#47-gitweb)
  - [4.8 GitLab](#48-gitlab)
  - [4.9 第三方托管的选择](#49-第三方托管的选择)

<!-- /code_chunk_output -->

## 4.1 协议

git 主要使用四种协议来传输数据：

- 本地协议（Local）
- HTTP 协议
- SSH（Secure Shell）协议
- Git 协议。

### 4.1.1 本地协议

远程版本库就是硬盘内的另一个目录。
常见于团队每一个成员都对一个共享的文件系统（例如一个挂载的 NFS）拥有访问权，或者比较少见的多人共用同一台电脑的情况。

使用版本库路径作为 URL,如果仅是指定路径，Git 会尝试使用硬链接（hard link）或直接复制所需要的文件，命令：

```shell
git clone [filepath]
git clone /opt/git/project.git
```

明确的指定 file://, Git 会触发平时用于网路传输资料的进程，那通常是传输效率较低的方法。 指定 file:// 的主要目的是取得一个没有外部参考（extraneous references）或对象（object）的干净版本库副本– 通常是在从其他版本控制系统导入后或一些类似情况:

```shell
git clone file://[filepath]
```

优点：

- 简单，直接使用了现有的文件权限和网络访问权限
- 快速从别人的工作目录中拉取更新的方法

缺点：

- 通常共享文件系统比较难配置，不方便从多个位置访问
- 并不保护仓库避免意外的损坏
- 没有方法可以阻止其他用户修改或删除 Git 内部文件和损坏仓库。

### 4.1.2 HTTP 协议

两种模式：

- 1.6.6 版本之前：一个方式，并且简单和只读。
- 1.6.6 版本之后：新的、更加智能的协议，像 ssh 那样智能的协商的传输数据。

**智能（Smart） HTTP 协议**

- 运行方式和 SSH 及 Git 协议类似，只是运行在标准的 HTTP/S 端口上并且可以使用各种 HTTP 验证机制
- 支持像 git:// 协议一样设置匿名服务
- 像 SSH 协议一样提供传输时的授权和加密
- 省去了为不同的需求设置不同的 URL

**哑（Dumb） HTTP 协议**

- 哑 HTTP 协议里 web 服务器仅把裸版本库当作普通文件来对待，提供文件服务。
- 只需要把一个裸版本库放在 HTTP 根目录，设置一个叫做 post-update 的挂钩就可以了

通常的，会在可以提供读／写的智能 HTTP 服务和简单的只读的哑 HTTP 服务之间选一个。

优点：

- 只关注智能 HTTP 协议的优点
- 只需要一个 URL 以及服务器只在需要授权时提示输入授权信息
- 对非资深的使用者，或者系统上缺少 SSH 相关程序的使用者，HTTP 协议的可用性是主要的优势。

缺点：

- 架设 HTTP/S 协议的服务端会比 SSH 协议的棘手一些。
- 如果你在 HTTP 上使用需授权的推送，管理凭证会比使用 SSH 密钥认证麻烦一些。

### 4.1.3 SSH 协议

架设 Git 服务器时常用 SSH 协议作为传输协议。

指定一个`ssh://`的 url：

```shell
git clone ssh://user@server/project.git
```

简短的 scp 写法：

```shell
git clone user@server:project.git
```

优势：

- SSH 架设相对简单
- 通过 SSH 访问是安全的 —— 所有传输数据都要经过授权和加密
- SSH 协议很高效，在传输前也会尽量压缩数据

缺点：

- 不能通过他实现匿名访问
- 使用者也要有通过 SSH 访问你的主机的权限，这使得 SSH 协议不利于开源的项目。

### 4.1.4 Git 协议

特殊的守护进程：

- 监听在一个特定的端口（9418），类似于 SSH 服务，但是访问无需任何授权。
- 让版本库支持 Git 协议，需要先创建一个 git-daemon-export-ok 文件 —— 它是 Git 协议守护进程为这个版本库提供服务的必要条件 —— 但是除此之外没有任何安全措施。

优点：

- Git 使用的网络传输协议里最快的
- 使用与 SSH 相同的数据传输机制，但是省去了加密和授权的开销。

缺点：

- 缺乏授权机制
- 最难架设的

## 4.2 在服务器上搭建 git

## 4.3 生成 ssh 公钥

## 4.4 配置服务器

## 4.5 Git 守护进程

## 4.6 Smart HTTP

## 4.7 GitWeb

## 4.8 GitLab

## 4.9 第三方托管的选择
