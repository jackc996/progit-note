# 二、git 基础

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [二、git 基础](#二-git-基础)
  - [2.1 获取 git 仓库](#21-获取-git-仓库)
    - [2.1.1 在现有目录中初始化 git](#211-在现有目录中初始化-git)
    - [2.1.2 克隆现有的仓库](#212-克隆现有的仓库)
  - [2.1.3 记录每次更新到仓库](#213-记录每次更新到仓库)
    - [2.1.4 检查当前文件状态](#214-检查当前文件状态)
    - [2.1.5 跟踪新文件](#215-跟踪新文件)
    - [2.1.6 暂存已修改文件](#216-暂存已修改文件)
    - [2.1.7 状态简览](#217-状态简览)
    - [2.1.8 忽略文件](#218-忽略文件)
    - [2.1.9 查看已暂存和未暂存的修改](#219-查看已暂存和未暂存的修改)
    - [2.1.10 提交更新](#2110-提交更新)
    - [2.1.11 跳过使用暂存区](#2111-跳过使用暂存区)
    - [2.1.12 移除文件](#2112-移除文件)
    - [2.1.13 移动文件](#2113-移动文件)
  - [2.2 查看提交历史](#22-查看提交历史)
    - [2.2.1 限制输出长度](#221-限制输出长度)
  - [2.3 撤销操作](#23-撤销操作)
    - [2.3.1 取消暂存的文件](#231-取消暂存的文件)
    - [2.3.2 撤销对文件的修改](#232-撤销对文件的修改)
  - [2.4 远程仓库的使用](#24-远程仓库的使用)
    - [2.4.1 查看远程仓库](#241-查看远程仓库)
    - [2.4.2 添加远程仓库](#242-添加远程仓库)
    - [2.4.3 从远程仓库抓取与拉取](#243-从远程仓库抓取与拉取)
    - [2.4.4 推送到远程仓库](#244-推送到远程仓库)
    - [2.4.5 查看远程仓库](#245-查看远程仓库)
    - [2.4.6 远程仓库移除与重命名](#246-远程仓库移除与重命名)
  - [2.5 打标签](#25-打标签)
    - [2.5.1 列出标签](#251-列出标签)
    - [2.5.2 创建标签](#252-创建标签)
    - [2.5.3 附注标签](#253-附注标签)
    - [2.5.4 轻量标签](#254-轻量标签)
    - [2.5.6 后期打标签](#256-后期打标签)
    - [2.5.7 共享标签](#257-共享标签)
    - [2.5.8 检出标签](#258-检出标签)
  - [2.6 Git 别名](#26-git-别名)

<!-- /code_chunk_output -->

## 2.1 获取 git 仓库

### 2.1.1 在现有目录中初始化 git

```shell
git init
```

### 2.1.2 克隆现有的仓库

```shell
git clone [url]
```

## 2.1.3 记录每次更新到仓库

文件状态变化周期
![](img/2022-11-13-16-14-53.png)

### 2.1.4 检查当前文件状态

```shell
 git status
```

### 2.1.5 跟踪新文件

```shell
git add 文件名
```

### 2.1.6 暂存已修改文件

修改了一个已被跟踪的文件，该文件会出现在 Changes not staged for commit 这行下面，说明已跟踪文件的内容发生了变化，但还没有放到暂存区。

git add：

- 可以用它开始跟踪新文件
- 或者把已跟踪的文件放到暂存区
- 还能用于合并时把有冲突的文件标记为已解决状态
- 理解为“添加内容到下一次提交中”而不是“将一个文件添加到项目中”要更加合适

### 2.1.7 状态简览

紧凑格式输出

```shell
git status -s
git status --short
```

解读：

- ??：新添加的未跟踪文件前面有 ?? 标记
- A：新添加到暂存区中的文件前面有 A 标记
- M：修改过的文件前面有 M 标记。
- MM： 出现在右边的 M 表示该文件被修改了但是还没放入暂存区，出现在靠左边的 M 表示该文件被修改了并放入了暂存区。

### 2.1.8 忽略文件

一些文件无须纳入 git 管理，创建 .gitignore 的文件

文件 .gitignore 的格式规范如下：

- 所有空行或者以 ＃ 开头的行都会被 Git 忽略。
- 可以使用标准的 glob 模式匹配。
- 匹配模式可以以（/）开头防止递归。
- 匹配模式可以以（/）结尾指定目录。
- 要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。

glob 模式：

- 星号（\*）匹配零个或多个任意字符；
- [abc] 匹配任何一个列在方括号中的字符（这个例子要么匹配一个 a，要么匹配一个 b，要么匹配一个 c）；
- 问号（?）只匹配一个任意字符；
- 如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配（比如 [0-9] 表示匹配所有 0 到 9 的数字）。
- 使用两个星号（\*) 表示匹配任意中间目录，比如`a/**/z` 可以匹配 a/z, a/b/z 或 `a/b/c/z`等。

> [GitHub 有一个十分详细的针对数十种项目及语言的 .gitignore 文件列表](https://github.com/github/gitignore)

### 2.1.9 查看已暂存和未暂存的修改

查看尚未暂存的文件更新了哪些部分：

```shell
git diff
```

此命令比较的是工作目录中当前文件和暂存区域快照之间的差异。

查看已暂存的将要添加到下次提交里的内容：

```shell
git diff --cached
git diff --staged // Git 1.6.1 及更高版本
```

图形化的方式或其它格式输出方式：

- git difftool 命令来用 Araxis ，emerge 或 vimdiff 等软件输出 diff 分析结果。
- 使用 git difftool --tool-help 命令来看你的系统支持哪些 Git Diff 插件。

### 2.1.10 提交更新

提交命令：

```shell
git commit
```

这种方式会启动文本编辑器以便输入本次提交的说明（默认会启用 shell 的环境变量 $EDITOR 所指定的软件，一般都是 vim 或 emacs）。使用 git config --global core.editor 命令设定编辑软件。

> ubuntu 默认的似乎是 nano，修改为 vim:`git config --global core.editor vim`

默认的提交消息包含最后一次运行 git status 的输出。-v 选项，这会将你所做的改变的 diff 输出放到编辑器。

将提交信息与命令放在同一行：

```shell
git commit -m "提交信息"
```

每次准备提交前，先用 git status 看下。然后再运行提交命令 git commit。

### 2.1.11 跳过使用暂存区

自动把所有已经跟踪过的文件暂存起来一并提交：

```shell
git commit -a
```

### 2.1.12 移除文件

从已跟踪文件清单中移除：

```shell
git rm 文件名
```

如果删除之前修改过并且已经放到暂存区域的话，则必须要用强制删除选项：

```shell
git rm -f 文件名
```

从 Git 仓库中删除（亦即从暂存区域移除），但仍然希望保留在当前工作目录中：

```shell
git rm --cached 文件名
```

> 可以使用 glob 模式，如： `git rm log/\*.log`

### 2.1.13 移动文件

Git 并不显式跟踪文件移动操作。

在 git 中给文件改名：

```shell
git mv file_from file_to
```

相当于执行了：

```shell
mv file_from file_to
git rm file_from
git add file_to
```

## 2.2 查看提交历史

回顾历史提交记录：

```shell
git log
```

按提交时间列出所有的更新，最近的更新排在最上面。出每个提交的 SHA-1 校验和、作者的名字和电子邮件地址、提交时间以及提交说明。

常用选项：

- -p，用来显示每次提交的内容差异。
- -2 来仅显示最近两次提交
- --stat 选项在每次提交的下面列出额所有被修改过的文件、有多少文件被修改了以及被修改过的文件的哪些行被移除或是添加了。 在每次提交的最后还有一个总结。
- --pretty。 这个选项可以指定使用不同于默认格式的方式展示提交历史。 oneline 将每个提交放在一行显示，查看的提交数很大时非常有用。 另外还有 short，full 和 fuller 可以用。format，可以定制要显示的记录格式。
- 当 oneline 或 format 与另一个 log 选项 --graph 结合使用时，添加了一些 ASCII 字符串来形象地展示你的分支、合并历史。

定制显示记录格式：

```shell
git log --pretty=format:"%h - %an, %ar : %s"
```

format 常用选项：

| 选项 | 说明                                        |
| ---- | ------------------------------------------- |
| %H   | 提交对象（commit）的完整哈希字串            |
| %h   | 提交对象的简短哈希字串                      |
| %T   | 树对象（tree）的完整哈希字串                |
| %t   | 树对象的简短哈希字串                        |
| %P   | 父对象（parent）的完整哈希字串              |
| %p   | 父对象的简短哈希字串                        |
| %an  | 作者（author）的名字                        |
| %ae  | 作者的电子邮件地址                          |
| %ad  | 作者修订日期（可以用 --date= 选项定制格式） |
| %ar  | 作者修订日期，按多久以前的方式显示          |
| %cn  | 提交者（committer）的名字                   |
| %ce  | 提交者的电子邮件地址                        |
| %cd  | 提交日期                                    |
| %cr  | 提交日期，按多久以前的方式显示              |
| %s   | 提交说明                                    |

> 作者：实际作出修改的人。 提交者：将此工作成果提交到仓库的人。

git log 的常用选项：

| 选项            | 说明                                                                                                  |
| --------------- | ----------------------------------------------------------------------------------------------------- |
| -p              | 按补丁格式显示每个更新之间的差异。                                                                    |
| --stat          | 显示每次更新的文件修改统计信息。                                                                      |
| --shortstat     | 只显示 --stat 中最后的行数修改添加移除统计。                                                          |
| --name-only     | 仅在提交信息后显示已修改的文件清单。                                                                  |
| --name-status   | 显示新增、修改、删除的文件清单。                                                                      |
| --abbrev-commit | 仅显示 SHA-1 的前几个字符，而非所有的 40 个字符。                                                     |
| --relative-date | 使用较短的相对时间显示（比如，“2 weeks ago”）。                                                       |
| --graph         | 显示 ASCII 图形表示的分支合并历史。                                                                   |
| --pretty        | 使用其他格式显示历史提交信息。可用的选项包括 oneline，short，full，fuller 和 format（后跟指定格式）。 |

### 2.2.1 限制输出长度

Git 在输出所有提交时会自动调用分页程序，所以你一次只会看到一页的内容。

照时间作限制的选项：--since 和 --until：

```shell
git log --since=2.weeks
```

> 具体的一天："2008-01-15"

--author 选项:显示指定作者的提交

--grep 选项:搜索提交说明中的关键字。

--all-match:同时满足多个选项

-S，列出那些添加或移除了某些字符串的提交：

```shell
git log -Sfunction_name
```

只关心某些文件或者目录的历史提交，可以在 git log 选项的最后指定它们的路径：

```shell
git log --path
```

限制 git log 输出的选项：

| 选项              | 说明                               |
| ----------------- | ---------------------------------- |
| -(n)              | 仅显示最近的 n 条提交              |
| --since, --after  | 仅显示指定时间之后的提交。         |
| --until, --before | 仅显示指定时间之前的提交。         |
| --author          | 仅显示指定作者相关的提交。         |
| --committer       | 仅显示指定提交者相关的提交。       |
| --grep            | 仅显示含指定关键字的提交           |
| -S                | 仅显示添加或移除了某个关键字的提交 |

## 2.3 撤销操作

漏了几个文件忘记提交或者提交信息写错了，尝试重新提交：

```shell
git commit --amend
```

这个命令会将暂存区中的文件提交。 如果自上次提交以来你还未做任何修改（例如，在上次提交后马上执行了此命令），那么快照会保持不变，而你所修改的只是提交信息。

### 2.3.1 取消暂存的文件

取消暂存：

```shell
git reset HEAD <file>...
```

### 2.3.2 撤销对文件的修改

撤销对文件的修改：

```shell
git checkout -- [file]
```

git checkout -- [file] 是一个危险的命令。你对那个文件做的任何修改都会消失 - 你只是拷贝了另一个文件来覆盖它。

## 2.4 远程仓库的使用

### 2.4.1 查看远程仓库

查看已经配置的远程仓库服务器，列出指定的每一个远程服务器的简写

```shell
git remote
```

选项 -v，会显示需要读写远程仓库使用的 Git 保存的简写与其对应的 URL

### 2.4.2 添加远程仓库

添加一个新的远程 Git 仓库，同时指定一个你可以轻松引用的简写：

```shell
git remote add <shortname> <url>
```

### 2.4.3 从远程仓库抓取与拉取

访问远程仓库，拉取没有的数据，执行完成将拥有那个远程仓库的所有分支与引用：

```shell
git fetch [remote-name]
```

如果你使用 clone 命令克隆了一个仓库，命令会自动将其添加为远程仓库并默认以 “origin” 为简写。

git fetch origin：

- 会抓取克隆（或上一次抓取）后新推送的所有工作。
- git fetch 命令会将数据拉取到你的本地仓库 - 它并不会自动合并或修改你当前的工作。

git pull:

- 如果你有一个分支设置为跟踪一个远程分支（阅读下一节与 Git 分支 了解更多信息），可以使用 git pull 命令来自动的抓取然后合并远程分支到当前分支。
- 默认情况下，git clone 命令会自动设置本地 master 分支跟踪克隆的远程仓库的 master 分支（或不管是什么名字的默认分支）。 运行 git pull 通常会从最初克隆的服务器上抓取数据并自动尝试合并到当前所在的分支。

### 2.4.4 推送到远程仓库

```shell
git push [remote-name] [branch-name]
```

### 2.4.5 查看远程仓库

```shell
git remote show [remote-name]
```

### 2.4.6 远程仓库移除与重命名

重命名引用的名字，修改远程仓库的简写：

```shell
git remote rename [old_name] [new_name]
```

移除一个远程仓库:

```shell
git remote rm [name]
```

## 2.5 打标签

Git 可以给历史中的某一个提交打上标签，以示重要。

### 2.5.1 列出标签

以字母顺序列出标签：

```shell
git tag
```

使用特定模式查找标签：

```shell
git tag -l 'v1.8.5*'
```

### 2.5.2 创建标签

Git 使用两种主要类型的标签：

- 轻量标签（lightweight）：轻量标签很像一个不会改变的分支 - 它只是一个特定提交的引用。
- 附注标签（annotated）。附注标签是存储在 Git 数据库中的一个完整对象。 它们是可以被校验的；其中包含打标签者的名字、电子邮件地址、日期时间；还有一个标签信息；并且可以使用 GNU Privacy Guard （GPG）签名与验证。

通常建议创建附注标签。

### 2.5.3 附注标签

-m 选项指定了一条将会存储在标签中的信息。

```shell
git tag -a v1.4 -m 'my version 1.4'
```

`git show`命令可以看到标签信息与对应的提交信息:

```shell
git show [标签名]
```

### 2.5.4 轻量标签

轻量标签本质上是将提交校验和存储到一个文件中 - 没有保存任何其他信息。

创建轻量标签，不需要使用 -a、-s 或 -m 选项，只需要提供标签名字：

```shell
git tag v1.4-lw
```

### 2.5.6 后期打标签

在命令的末尾指定提交的校验和（或部分校验和）:

```shell
git tag -a [标签名] [校验和]
```

### 2.5.7 共享标签

默认情况下，git push 命令并不会传送标签到远程仓库服务器上。 在创建完标签后你必须显式地推送标签到共享服务器上。 ：

```shell
git push origin [标签名]
```

一次性推送多个标签：--tags 选项：

### 2.5.8 检出标签

> 不太理解

如果你想要工作目录与仓库中特定的标签版本完全一样，可以使用 git checkout -b [branchname] [tagname] 在特定的标签上创建一个新分支：

```shell
git checkout -b version2 v2.0.0
```

## 2.6 Git 别名

为 git 命令设置别名：

```shell
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.st status
git config --global alias.unstage 'reset HEAD --'
```

执行外部命令，而不是一个 Git 子命令，在命令前面加上`!`:

```shell
git config --global alias.visual '!gitk'
```
